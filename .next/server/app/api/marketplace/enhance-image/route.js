"use strict";(()=>{var e={};e.id=672,e.ids=[672],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4372:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{OPTIONS:()=>h,POST:()=>p,runtime:()=>u});var n=r(9303),i=r(8716),o=r(670),s=r(4664),l=r(3514);let u="nodejs";function h(){return(0,s.U1)()}async function p(e){try{let{base64:t,mimeType:r}=await (0,s.zr)(e)||{};if(!t||!r)return(0,s.wE)({error:"validation_error",message:"base64 dan mimeType diperlukan"},400);let a=(0,l.N)(t);try{let e=await (0,l.p)(a);return(0,s.wE)({success:!0,enhanced:{base64:e.base64,mimeType:e.mimeType,width:e.width,height:e.height,originalWidth:e.originalWidth,originalHeight:e.originalHeight,sizeReduction:e.sizeReduction}})}catch(e){return console.error("Sharp processing error:",e),(0,s.wE)({success:!1,error:"enhancement_failed",message:"Gagal melakukan enhancement, menggunakan gambar asli",original:{base64:t,mimeType:r}})}}catch(e){return console.error("Exception enhancing image:",e),(0,s.wE)({error:"server_error",message:e.message},500)}}let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/marketplace/enhance-image/route",pathname:"/api/marketplace/enhance-image",filename:"route",bundlePath:"app/api/marketplace/enhance-image/route"},resolvedPagePath:"D:\\Semester 3\\FSD\\SampahKuPilah - Copy\\SampahKuPilah\\app\\api\\marketplace\\enhance-image\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:d,serverHooks:m}=c,w="/api/marketplace/enhance-image/route";function f(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},9303:(e,t,r)=>{e.exports=r(517)},4664:(e,t,r)=>{r.d(t,{U1:()=>i,wE:()=>n,zr:()=>o});let a={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-User-Email"};function n(e,t=200,r={}){return new Response(JSON.stringify(e),{status:t,headers:{"Content-Type":"application/json",...a,...r}})}function i(){return new Response(null,{status:204,headers:a})}async function o(e){try{return await e.json()}catch{return null}}},3514:(e,t,r)=>{r.d(t,{N:()=>n,p:()=>i});let a=require("sharp");function n(e){return Buffer.from(e,"base64")}async function i(e){let t=await a(e).metadata(),r=t.width,n=t.height;r&&n&&(r>1920||n>1920)&&(r>n?(r=1920,n=Math.round(t.height/t.width*1920)):(n=1920,r=Math.round(t.width/t.height*1920)));let i=a(e);r&&n&&(i=i.resize(r,n,{fit:"inside",withoutEnlargement:!0}));let o=await i.modulate({brightness:1.05,saturation:1.1}).sharpen({sigma:1,flat:1,jagged:2}).normalize().jpeg({quality:85,progressive:!0,mozjpeg:!0}).toBuffer(),s=e.length>0?`${Math.round((1-o.length/e.length)*100)}%`:"0%";return{buffer:o,base64:o.toString("base64"),mimeType:"image/jpeg",width:r||t.width||null,height:n||t.height||null,originalWidth:t.width||null,originalHeight:t.height||null,sizeReduction:s}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(4372));module.exports=a})();