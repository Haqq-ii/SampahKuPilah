"use strict";(()=>{var e={};e.id=730,e.ids=[730],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2791:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>d,OPTIONS:()=>l,runtime:()=>c});var s=r(9303),a=r(8716),o=r(670),i=r(4664),u=r(8387);let c="nodejs";function l(){return(0,i.U1)()}async function d(){try{if(!u.OQ)return(0,i.wE)({connected:!1,message:"Supabase not configured"},503);let{error:e,count:t}=await u.OQ.from("detections").select("*",{count:"exact",head:!0});if(e)return(0,i.wE)({connected:!1,error:e.message,hint:"Pastikan tabel 'detections' sudah dibuat di Supabase"},500);return(0,i.wE)({connected:!0,message:"Tabel detections accessible!",detections:{accessible:!0,recordCount:t||0}})}catch(e){return(0,i.wE)({connected:!1,error:e.message},500)}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/supabase/test/detections/route",pathname:"/api/supabase/test/detections",filename:"route",bundlePath:"app/api/supabase/test/detections/route"},resolvedPagePath:"D:\\Semester 3\\FSD\\SampahKuPilah - Copy\\SampahKuPilah\\app\\api\\supabase\\test\\detections\\route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=p,g="/api/supabase/test/detections/route";function S(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},4664:(e,t,r)=>{r.d(t,{U1:()=>a,wE:()=>s,zr:()=>o});let n={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-User-Email"};function s(e,t=200,r={}){return new Response(JSON.stringify(e),{status:t,headers:{"Content-Type":"application/json",...n,...r}})}function a(){return new Response(null,{status:204,headers:n})}async function o(e){try{return await e.json()}catch{return null}}},8387:(e,t,r)=>{r.d(t,{Ix:()=>d,NF:()=>s,OQ:()=>u,Oo:()=>m,Qr:()=>p,R:()=>c,WB:()=>l,mI:()=>f});var n=r(4128);let s=process.env.SUPABASE_URL?.trim()||"",a=process.env.SUPABASE_SERVICE_ROLE?.trim()||process.env.SUPABASE_SERVICE_KEY?.trim()||"",o=process.env.SUPABASE_ANON_KEY?.trim()||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2c2VhZWhmcXJ4emt2b2VqZ3VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MzI2NjYsImV4cCI6MjA3OTEwODY2Nn0.Jp9SN_U-xJBay1uhyiGVKbyF9Tjsuse5QxHiBeH5S7U".trim()||"",i=a||o,u=s&&i?(0,n.eI)(s,i):null,c=e=>"string"==typeof e?e.trim().toLowerCase():"";async function l(e){if(!u)return null;try{let t=c(e),{data:r,error:n}=await u.from("users").select("*").eq("email",t).single();if(n)return"PGRST116"!==n.code&&console.error("Error finding user in Supabase:",n),null;return r}catch(e){return console.error("Exception finding user in Supabase:",e),null}}async function d(e){if(!u)return null;try{let{data:t,error:r}=await u.from("users").insert({email:c(e.email),password_hash:e.passwordHash||null,provider:e.provider||"local",name:e.name||null,picture:e.picture||null}).select().single();if(r)return console.error("Error creating user in Supabase:",r),null;return t}catch(e){return console.error("Exception creating user in Supabase:",e),null}}async function p(e){if(!s||!a)return null;try{let t=c(e),r=await fetch(`${s}/auth/v1/admin/users`,{method:"GET",headers:{apikey:a,Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(r.ok){let e=await r.json();if(e?.users&&Array.isArray(e.users)){let r=e.users.find(e=>e.email&&e.email.toLowerCase()===t);if(r?.id)return console.log(`Found auth user for ${t}: ${r.id}`),r.id}}else{let e=await r.text();console.warn("Error listing auth users:",e.substring(0,200))}let n=await fetch(`${s}/auth/v1/admin/users`,{method:"POST",headers:{apikey:a,Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({email:t,email_confirm:!0,user_metadata:{}})});if(n.ok){let e=await n.json();if(e?.user?.id)return console.log(`Created auth user for ${t}: ${e.user.id}`),e.user.id}else{let e=await n.text();console.error("Error creating auth user:",e.substring(0,200))}return console.warn(`Auth user ID not found/created for ${t}`),null}catch(e){return console.error("Error getting/creating auth user ID:",e.message),null}}async function m(e,t){if(!u)return null;try{let{data:r,error:n}=await u.from("detections").insert({user_email:c(e),category:t.category||t.bin||"abu-abu",bin_name:t.bin_name||t.dominant_class||"Residu",confidence:t.confidence||.8,reason:t.reason||"Auto-detected",created_at:new Date().toISOString()}).select().single();if(n)return console.error("Error saving detection to Supabase:",n),null;return console.log("Detection saved to Supabase:",r.id),r}catch(e){return console.error("Exception saving detection to Supabase:",e),null}}async function f(e,t=50){if(!u)return[];try{let{data:r,error:n}=await u.from("detections").select("*").eq("user_email",c(e)).order("created_at",{ascending:!1}).limit(t);if(n)return console.error("Error fetching detections from Supabase:",n),[];return r||[]}catch(e){return console.error("Exception fetching detections from Supabase:",e),[]}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,885],()=>r(2791));module.exports=n})();