"use strict";(()=>{var e={};e.id=191,e.ids=[191],e.modules={7096:e=>{e.exports=require("bcrypt")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4210:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>I,patchFetch:()=>P,requestAsyncStorage:()=>b,routeModule:()=>S,serverHooks:()=>A,staticGenerationAsyncStorage:()=>v});var a={};t.r(a),t.d(a,{OPTIONS:()=>E,POST:()=>y,runtime:()=>c});var n=t(9303),i=t(8716),s=t(670),o=t(7096),l=t(4664),u=t(8387);let c="nodejs",d="1"===process.env.VERCEL||process.env.VERCEL_ENV,p=new Map,m=e=>"string"==typeof e?e.trim().toLowerCase():"",g=e=>{if(!e||"string"!=typeof e)return{valid:!1,error:"Email wajib diisi"};let r=e.trim().toLowerCase();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r))return{valid:!1,error:"Format email tidak valid"};if(r.length>254)return{valid:!1,error:"Email terlalu panjang"};let[t]=r.split("@");return t.length>64?{valid:!1,error:"Email tidak valid"}:r.startsWith(".")||r.endsWith(".")||r.includes("..")?{valid:!1,error:"Format email tidak valid"}:{valid:!0,error:null}},f=e=>{if(!e||"string"!=typeof e)return{valid:!1,errors:["Password wajib diisi"]};let r=[];return e.length<8&&r.push("Password minimal 8 karakter"),/[A-Z]/.test(e)||r.push("Password harus mengandung huruf besar (A-Z)"),/[a-z]/.test(e)||r.push("Password harus mengandung huruf kecil (a-z)"),/[0-9]/.test(e)||r.push("Password harus mengandung angka (0-9)"),{valid:0===r.length,errors:r}},h=(e,r=5,t=9e5)=>{let a=Date.now();if(!p.has(e))return p.set(e,{count:1,resetAt:a+t}),{allowed:!0,remaining:r-1};let n=p.get(e);return a>n.resetAt?(n.count=1,n.resetAt=a+t,{allowed:!0,remaining:r-1}):n.count>=r?{allowed:!1,remaining:0,retryAfter:Math.ceil((n.resetAt-a)/1e3)}:(n.count+=1,{allowed:!0,remaining:r-n.count})},w=e=>{let r=e.headers.get("x-forwarded-for");return r?r.split(",")[0].trim():e.headers.get("x-real-ip")||"unknown"};function E(){return(0,l.U1)()}async function y(e){try{let r=w(e),t=h(`register:${r}`,5,9e5);if(!t.allowed)return(0,l.wE)({message:`Terlalu banyak percobaan. Coba lagi dalam ${Math.ceil(t.retryAfter/60)} menit.`,retryAfter:t.retryAfter},429);let{email:a,password:n}=await (0,l.zr)(e)||{},i=g(a);if(!i.valid)return(0,l.wE)({message:i.error},400);let s=m(a),c=f(n);if(!c.valid)return(0,l.wE)({message:c.errors.join(", ")},400);let E=null;if(u.OQ&&(E=await (0,u.WB)(s)),E)return(0,l.wE)({message:"Email sudah terdaftar"},409);let y=await o.hash(n,10);if(u.OQ){if(!await (0,u.Ix)({email:s,passwordHash:y,provider:"local"})&&d)return console.error("Failed to create user in Supabase on Vercel"),(0,l.wE)({message:"Gagal membuat akun. Pastikan Supabase dikonfigurasi dengan benar."},500)}else if(d)return console.error("Supabase not configured on Vercel"),(0,l.wE)({message:"Database tidak tersedia. Pastikan Supabase dikonfigurasi."},500);return p.delete(`register:${r}`),(0,l.wE)({message:"Pendaftaran berhasil"})}catch(e){return console.error("Registration error:",e),(0,l.wE)({message:"Terjadi kesalahan server"},500)}}let S=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/register/route",pathname:"/register",filename:"route",bundlePath:"app/register/route"},resolvedPagePath:"D:\\Semester 3\\FSD\\SampahKuPilah - Copy\\SampahKuPilah\\app\\register\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:b,staticGenerationAsyncStorage:v,serverHooks:A}=S,I="/register/route";function P(){return(0,s.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:v})}},4664:(e,r,t)=>{t.d(r,{U1:()=>i,wE:()=>n,zr:()=>s});let a={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-User-Email"};function n(e,r=200,t={}){return new Response(JSON.stringify(e),{status:r,headers:{"Content-Type":"application/json",...a,...t}})}function i(){return new Response(null,{status:204,headers:a})}async function s(e){try{return await e.json()}catch{return null}}},8387:(e,r,t)=>{t.d(r,{Ix:()=>d,NF:()=>n,OQ:()=>l,Oo:()=>m,Qr:()=>p,R:()=>u,WB:()=>c,mI:()=>g});var a=t(4128);let n=process.env.SUPABASE_URL?.trim()||"",i=process.env.SUPABASE_SERVICE_ROLE?.trim()||process.env.SUPABASE_SERVICE_KEY?.trim()||"",s=process.env.SUPABASE_ANON_KEY?.trim()||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2c2VhZWhmcXJ4emt2b2VqZ3VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MzI2NjYsImV4cCI6MjA3OTEwODY2Nn0.Jp9SN_U-xJBay1uhyiGVKbyF9Tjsuse5QxHiBeH5S7U".trim()||"",o=i||s,l=n&&o?(0,a.eI)(n,o):null,u=e=>"string"==typeof e?e.trim().toLowerCase():"";async function c(e){if(!l)return null;try{let r=u(e),{data:t,error:a}=await l.from("users").select("*").eq("email",r).single();if(a)return"PGRST116"!==a.code&&console.error("Error finding user in Supabase:",a),null;return t}catch(e){return console.error("Exception finding user in Supabase:",e),null}}async function d(e){if(!l)return null;try{let{data:r,error:t}=await l.from("users").insert({email:u(e.email),password_hash:e.passwordHash||null,provider:e.provider||"local",name:e.name||null,picture:e.picture||null}).select().single();if(t)return console.error("Error creating user in Supabase:",t),null;return r}catch(e){return console.error("Exception creating user in Supabase:",e),null}}async function p(e){if(!n||!i)return null;try{let r=u(e),t=await fetch(`${n}/auth/v1/admin/users`,{method:"GET",headers:{apikey:i,Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();if(e?.users&&Array.isArray(e.users)){let t=e.users.find(e=>e.email&&e.email.toLowerCase()===r);if(t?.id)return console.log(`Found auth user for ${r}: ${t.id}`),t.id}}else{let e=await t.text();console.warn("Error listing auth users:",e.substring(0,200))}let a=await fetch(`${n}/auth/v1/admin/users`,{method:"POST",headers:{apikey:i,Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({email:r,email_confirm:!0,user_metadata:{}})});if(a.ok){let e=await a.json();if(e?.user?.id)return console.log(`Created auth user for ${r}: ${e.user.id}`),e.user.id}else{let e=await a.text();console.error("Error creating auth user:",e.substring(0,200))}return console.warn(`Auth user ID not found/created for ${r}`),null}catch(e){return console.error("Error getting/creating auth user ID:",e.message),null}}async function m(e,r){if(!l)return null;try{let{data:t,error:a}=await l.from("detections").insert({user_email:u(e),category:r.category||r.bin||"abu-abu",bin_name:r.bin_name||r.dominant_class||"Residu",confidence:r.confidence||.8,reason:r.reason||"Auto-detected",created_at:new Date().toISOString()}).select().single();if(a)return console.error("Error saving detection to Supabase:",a),null;return console.log("Detection saved to Supabase:",t.id),t}catch(e){return console.error("Exception saving detection to Supabase:",e),null}}async function g(e,r=50){if(!l)return[];try{let{data:t,error:a}=await l.from("detections").select("*").eq("user_email",u(e)).order("created_at",{ascending:!1}).limit(r);if(a)return console.error("Error fetching detections from Supabase:",a),[];return t||[]}catch(e){return console.error("Exception fetching detections from Supabase:",e),[]}}}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,885],()=>t(4210));module.exports=a})();